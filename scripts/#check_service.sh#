#!/bin/bash

if [ "$#" = 0 ]
  then
    echo "Usage $0 "
  exit 1
fi

service=$1
is_running=`ps aux | grep -v grep| grep -v "$0" | grep $service| wc -l | awk '{print $1}'`

if [ $is_running != "0" ]
then
    echo "Service $service is running"
else
    echo
    initd=`ls /etc/init.d/ | grep $service | wc -l | awk '{ print $1 }'`
    if [ $initd = "1" ];
    then
      startup=`ls /etc/init.d/ | grep $service`
      echo -n "Found startap script /etc/init.d/${startup}. Starting the $service "
      /etc/init.d/${startup} start
      curl -X POST --data-urlencode 'payload={"channel": "#devops", "username": "watchdog-ES", "text": "Alert: Elasticsearch started on `hostname -fi`", "icon_emoji": ":ghost:"}' https://hooks.slack.com/services/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
      fi
fi
fi



curl -X POST --data "payload={\"channel\": \"${SLACK_CHANNEL}\", \"username\": \"${SLACK_USERNAME}\", \"text\": \"${ICON} HOST: ${NAGIOS_HOSTNAME}   SERVICE: ${NAGIOS_SERVICEDISPLAYNAME}     MESSAGE: ${NAGIOS_SERVICEOUTPUT} <https://${MY_NAGIOS_HOSTNAME}/cgi-bin/nagios3/status.cgi?host=${NAGIOS_HOSTNAME}|See Nagios>\"}" https://${SLACK_HOSTNAME}/services/hooks/incoming-webhook?token=${SLACK_TOKEN}


SLACK_CHANNEL=
SLACK_USERNAME=
MESSAGE=""
curl -X POST --data-urlencode 'payload={\"channel\": \"${SLACK_CHANNEL}\", \"username\": \"${SLACK_USERNAME}\", \"text\": \"SERVICE: ${service} HOST: ${hostname}  MESSAGE: ${MESSAGE} , "icon_emoji": ":ghost:"}' https://hooks.slack.com/services/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

 curl -X POST -H 'Content-type: application/json' --data '{"text":"Service  '$HOSTNAME' with instanceid '$INSTANCE'"}' $SLACK_HOOK && return 0

